---
title: 'Agregar parámetros de consulta de anuncios con los SDK nativos'
description: En este tema, aprenderá cómo agregar parámetros de consulta de publicidad a sus URL de VMAP con los SDK de Brightcove Native Player.
parent: Features 
grandparent: Home
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">Descripción general</h2>

<p>Aunque los SDK del reproductor nativo no realizan el reemplazo de macros del lado del cliente, puede agregar manualmente parámetros de cadena de consulta para la orientación de anuncios. Esto se puede hacer para anuncios del lado del cliente o del lado del servidor.</p>

<p>Para obtener más información sobre los parámetros de URL, consulte la <a href="https://ssai.support.brightcove.com/vod/guides/video-cloud-ssai-ad-config-api.html#Ad_variables">Variables publicitarias</a> sección del documento de API de configuración de anuncios SSAI de Video Cloud.</p>
</section>

<section class="bcls-section">
<h2 id="Client_side_ads">Anuncios del lado del cliente</h2>
<p>Puede proporcionar valores personalizados a través de parámetros de URL adjuntos a la URL de VMAP.</p>
<aside class="bcls-aside bcls-aside--information">Solo es posible agregar parámetros de consulta a la URL de una etiqueta de anuncio con los anuncios IMA de Google. Google IMA es el único proveedor de anuncios que expone la URL de la etiqueta de anuncio para este propósito; otros proveedores de anuncios, como FreeWheel y Pulse, proporcionan un conjunto de parámetros de configuración.</aside>

<h3>Implementación de Android</h3>
<p>Los pares clave / valor de orientación de anuncios se pueden agregar a la URL de su etiqueta de anuncio de dos maneras:</p>
<ul>
  <li>
    Agregue sus pares clave / valor directamente a la URL de la etiqueta de anuncio. Google IMA permite la adición de pares clave / valor de orientación de anuncios mediante el <code translate="No">cust_params</code> parámetro. Para obtener más detalles, consulte el <a href="https://support.google.com/admanager/answer/1080597">Agregar pares clave-valor a una etiqueta de anuncio de video maestro</a> documento.
  </li>
  <li>
    Aplique un mapa de valores a la URL de la etiqueta de anuncio mediante el <code translate="No">updateAdTargetingValues</code> método para el <code translate="No">GoogleIMAComponent</code>.
  </li>
</ul>
<p>Para cualquier enfoque, los pares clave / valor se agregan a la URL de la etiqueta de anuncio en el <code translate="No">ADS_REQUEST_FOR_VIDEO</code> oyente de eventos. El ejemplo de código a continuación agrega los pares clave / valor usando el <code translate="No">updateAdTargetingValues</code> método para el <code translate="No">GoogleIMAComponent</code>.</p>

<p>Aquí está el código para crear un mapa de pares clave / valor, usando el <code translate="No">CUSTOM_FIELDS</code> propiedad de la <code translate="No">Video</code> propiedad del objeto del <code translate="No">ADS_REQUEST_FOR_VIDEO</code> evento:</p>
<pre>
<code class="language-swift" translate="No">Video video = (Video) event.getProperties().get(Event.VIDEO);
if (video != null) {
    Map&lt;String, String&gt; customFieldsMap = (HashMap&lt;String, String&gt;) video.getProperties().get(Video.Fields.CUSTOM_FIELDS);
}
</code></pre>

<p>Aquí hay una muestra de código completa para el <code translate="No">ADS_REQUEST_FOR_VIDEO</code> detector de eventos, que se agrega al método de configuración del complemento Google IMA:</p>
<pre>
<code class="language-swift" translate="No">eventEmitter.on(GoogleIMAEventType.ADS_REQUEST_FOR_VIDEO, event -&gt; {
    // Create a container object for the ads to be presented.
    AdDisplayContainer container = sdkFactory.createAdDisplayContainer();
    container.setPlayer(googleIMAComponent.getVideoAdPlayer());
    container.setAdContainer(brightcoveVideoView);
    // Build an ads request object and point it to the ad
    // display container created above.
    AdsRequest adsRequest = sdkFactory.createAdsRequest();

    // Set Ad Targeting values, using the Video object's Custom Fields
    // (if they are present; if they are not present, use default values instead) 
    Video video = (Video) event.getProperties().get(Event.VIDEO);
    if (video != null) {
        Map&lt;String, String&gt; customFieldsMap = (HashMap&lt;String, String&gt;) video.getProperties().get(Video.Fields.CUSTOM_FIELDS);
        if (customFieldsMap != null) { 
            googleIMAComponent.updateAdTargetingValues(customFieldsMap);
        }
    }

    adsRequest.setAdTagUrl(adRulesURL);
    adsRequest.setAdDisplayContainer(container);
    ArrayList&lt;AdsRequest&gt; adsRequests = new ArrayList&lt;AdsRequest&gt;(1);
    adsRequests.add(adsRequest);
    // Respond to the event with the new ad requests.
    event.properties.put(GoogleIMAComponent.ADS_REQUESTS, adsRequests);
    eventEmitter.respond(event);
});
</code></pre>

<h3>Implementación de iOS</h3>
<p>Para agregar parámetros de consulta de anuncios con el SDK nativo para iOS, siga estos pasos:</p>
<ol class="bcls-tasklist-restart">
	<li>
	<p>Comience con uno de los ejemplos de código del lado del cliente para publicidad IMA con Brightcove Native SDK:</p>

	<ul>
		<li><a href="https://github.com/BrightcoveOS/ios-player-samples">Muestras de reproductores de iOS</a></li>
	</ul>
	</li>
	<li>
	<p>Agregue los parámetros de consulta de URL a la URL de VMAP antes de llamar al complemento IMA. Esto se puede hacer antes de los siguientes métodos:</p>

	<pre>
<code class="language-objectivec" translate="No">for video in mutablePlaylist.videos {
  if let _video = video as? BCOVMutableVideo {
     _video.properties[kBCOVIMAAdTag] = IMAConfig.VMAPResponseAdTag
    updatedVideos.append(_video)
  }
}</code></pre>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Server_side_ads">Anuncios del lado del servidor</h2>

<p>Para proporcionar valores personalizados a través de parámetros de URL adjuntos a la URL de VMAP, siga estos pasos:</p>

<ol class="bcls-tasklist-restart">
	<li>
	<p>Con un ID de configuración de anuncios SSAI, recupere un objeto de video del catálogo de Brightcove (API de reproducción). Aprenda a crear una configuración de anuncios con el <a href="/features/implementing-server-side-ads-native-player-sdks.html#Create_an_ad_configuration">Implementación de anuncios del lado del servidor con los SDK del reproductor nativo</a> documento.</p>

	<p>Una configuración de anuncio de muestra tiene este aspecto:</p>

	<pre class="line-numbers">
<code class="language-swift" translate="No">{
  "name": "SSAI VMAP Ad Server",
  "vmap_response_namespace": "bc",
  "config_id": "<span class="bcls-input">your ad config Id</span>",
  "account_id": "1752604059001",
  "created_timestamp": "2017-10-24T20:21:55.106488973Z",
  "updated_timestamp": "2017-10-26T14:26:22.161791419Z",
  "ad_config": {
  	"enable_ads": true,
  	"expected_ad_response": "dfp_vmap",
  	"proxy_beacons_enabled": false,
  	"template_url": {
  		"template": "https://solutions.brightcove.com/bcls/brightcove-player/vmap/simple-vmap.xml"
  	}
  }
}</code></pre>

	<aside class="bcls-aside bcls-aside--tip">los <code translate="No">template_url</code> La propiedad contiene la URL del anuncio.</aside>
	</li>
	<li>
	<p>En jsonResponse de la llamada a la API de reproducción, examine las fuentes del objeto de video. Cada objeto de origen contendrá una propiedad VMAP y una URL VMAP. Seleccione y extraiga la URL de VMAP.</p>

	<pre>
<code class="language-swift" translate="No">http://ssaiplayback.prod.boltdns.net/playback/once/v1/vmap/hls/v3/clear/3981276734001/
  b871a6b8-4b3e-4787-b176-aed923287d5a/477b1308-fc18-47a6-bb99-6cb9e2ff2040/
  content.vmap<span class="bcls-highlight">?bc_token=XXX</span></code></pre>

	<aside class="bcls-aside bcls-aside--tip">El único parámetro de URL en la URL de VMAP será el <code translate="No">bc_token</code>.</aside>
	</li>
	<li>
	<p>Supongamos que la URL de su anuncio se ve así:</p>

	<pre>
<code class="language-swift" translate="No">https://myad.com/ads?rule={{url.rule}}&amp;id={{url.video.id}}</code></pre>

	<p>Si la URL de su anuncio tiene las macros de anuncios anteriores, agregará estos parámetros de consulta a las URL de VMAP con los valores adecuados.</p>
	</li>
	<li>
	<p>Agregue parámetros de consulta a la URL de VMAP. En este ejemplo, el <code translate="No">{{url.rule}}</code> La macro en la URL del anuncio se reemplaza por el valor. <code translate="No">discos-enabled</code> , y el <code translate="No">{{url.video_id}}</code> La macro se reemplaza con el valor de identificación del video.</p>

	<pre>
<code class="language-swift" translate="No">http://ssaiplayback.prod.boltdns.net/playback/once/v1/vmap/hls/v3/clear/3981276734001/
b871a6b8-4b3e-4787-b176-aed923287d5a/477b1308-fc18-47a6-bb99-6cb9e2ff2040/
content.vmap<span class="bcls-highlight">?bc_token=XXX&amp;rule=discos-enabled&amp;video_id=5625751316001</span></code></pre>
	</li>
	<li>Procese el video con el complemento SSAI.</li>
	<li>
	<p>Para obtener detalles sobre el desarrollo, consulte lo siguiente:</p>

	<ul>
		<li><a href="#Android_implementation">Implementación de Android</a></li>
		<li><a href="#iOS_implementation">Implementación de iOS</a></li>
	</ul>
	</li>
</ol>

<h3 id="Android_implementation">Implementación de Android</h3>

<p>De la respuesta de la API de reproducción, puede extraer la URL de origen VMAP adecuada y agregar los parámetros de su consulta. Para hacer esto, siga estos pasos:</p>

<ol class="bcls-tasklist-restart">
	<li>Con un ID de configuración de anuncios SSAI, recupere un objeto de video del catálogo de Brightcove (API de reproducción). Para obtener más detalles, consulte la <a href="/features/implementing-server-side-ads-native-player-sdks.html#Android_implementation">Implementación de Android</a> sección del documento Implementación de anuncios del lado del servidor con los SDK de Native Player.</li>
  <li>
    <p>
      En el <code translate="No">Catalog</code>'s <code translate="No">onVideo</code> método de devolución de llamada, seleccione y extraiga la URL VMAP adecuada del <code translate="No">Video</code> fuente predeterminada del objeto, utilizando el <code translate="No">SSAISourceSelector</code>. El objeto de origen devuelto debe tener una propiedad de URL de VMAP.
    </p>
    <pre>
<code class="language-swift" translate="No">SSAISourceSelector sourceSelector = new SSAISourceSelector();
Source source = sourceSelector.selectSource(video);            
String vmapUrl = source.getStringProperty(Source.Fields.VMAP);</code></pre>
  </li>
  <li>
    <p>
      Agregue sus parámetros de consulta a la URL de VMAP:
    </p>
    <pre>
<code class="language-swift" translate="No">private String configureVmapUrlWithCustomParams(String vmapUrl, Map&lt;String, String&gt; vmapUrlParams) {
    Uri.Builder vmapBuilder = Uri.parse(vmapUrl).buildUpon();
    for (Map.Entry&lt;String, String&gt; entry : vmapUrlParams.entrySet()) {
        vmapBuilder.appendQueryParameter(entry.getKey(), entry.getValue());
    }
    return vmapBuilder.toString();
}</code></pre>
  </li>
  <li>
    <p>
      Procesar la actualización <code translate="No">Video</code> objeto con el complemento SSAI de la siguiente manera:
    </p>
    <pre>
<code class="language-swift" translate="No">plugin.processVideo(video);</code></pre>
  </li>
</ol>
<p>Aquí hay una muestra de código completa:</p>
<pre>
<code class="language-swift" translate="No">HttpRequestConfig httpRequestConfig = new HttpRequestConfig.Builder()
        .addQueryParameter(AD_CONFIG_ID_QUERY_PARAM_KEY, AD_CONFIG_ID_QUERY_PARAM_VALUE)
        .build();
Map&lt;String, String&gt; vmapUrlParams = new HashMap&lt;&gt;();
vmapUrlParams.put(&quot;section&quot;, &quot;sports&quot;);
vmapUrlParams.put(&quot;multi&quot;, &quot;baseball,tennis&quot;);

catalog.findVideoByID(getString(R.string.video_id), httpRequestConfig, new VideoListener() {
    @Override public void onVideo(Video video) {
        // The Video Sources will have a VMAP url which will be processed by the SSAI plugin,
        // If there is not a VMAP url, or if there are any requesting or parsing error,
        // an EventType.ERROR event will be emitted.
        try{
            SSAISourceSelector sourceSelector = new SSAISourceSelector();
            Source source = sourceSelector.selectSource(video);
            String vmapUrl = source.getStringProperty(Source.Fields.VMAP);
            source.getProperties().put(Source.Fields.VMAP, configureVmapUrlWithCustomParams(vmapUrl, vmapUrlParams)); plugin.processVideo(video);
        }
        catch (NoSourceFoundException ns) {
            Log.e(TAG, &quot;No usable source was found - &quot; + ns.getMessage());
        }
    }
});

private String configureVmapUrlWithCustomParams(String vmapUrl, Map&lt;String, String&gt; vmapUrlParams) {
    Uri.Builder vmapBuilder = Uri.parse(vmapUrl).buildUpon();
    for (Map.Entry&lt;String, String&gt; entry : vmapUrlParams.entrySet()) {
        vmapBuilder.appendQueryParameter(entry.getKey(), entry.getValue());
    }
    return vmapBuilder.toString();
}</code></pre>

<h3 id="iOS_implementation">Implementación de iOS</h3>

<p>De la respuesta de la API de reproducción, puede extraer la URL de origen VMAP adecuada y agregar los parámetros de su consulta. Para hacer esto, siga estos pasos:</p>

<ol class="bcls-tasklist-restart">
	<li>Con un ID de configuración de anuncios SSAI, recupere un objeto de video del catálogo de Brightcove (API de reproducción). Para obtener más detalles, consulte la <a href="/features/implementing-server-side-ads-native-player-sdks.html#iOS_implementation">Implementación de iOS</a> sección del documento Implementación de anuncios del lado del servidor con los SDK de Native Player.</li>
	<li>
	<p>Desde el objeto de video, seleccione y extraiga el manifiesto apropiado o la URL de VMAP. De la respuesta del servicio de reproducción, jsonResponse (NSDictionary) contiene el <a href="/ios/reference/sdk/Classes/BCOVVideo.html">BCOVVídeo</a> objeto, que incluye las fuentes que contienen la URL del documento VMAP. Su código puede verse similar a esto:</p>

	<pre>
<code class="language-swift" translate="No">// Create a mutable version of the jsonResponse NSDictionary object
NSURLComponents *components = [[NSURLComponents alloc] init];
NSMutableDictionary *videoPropertiesDictionary = [[NSMutableDictionary alloc] init];
NSMutableArray *updatedSources = [[NSMutableArray alloc] init];

// Define the URL parameters that will be added to the VMAP URL
NSURLQueryItem *queryItemEntrypointUrlParameter = [NSURLQueryItem queryItemWithName:@"rule" value:@"discos-enabled"];
NSURLQueryItem *queryItemVideoId = [NSURLQueryItem queryItemWithName:@"video_id" value:jsonResponse[@"id"]];

//deserialize the video and store in dictionary
[videoPropertiesDictionary addEntriesFromDictionary:jsonResponse];</code></pre>
	</li>
	<li>
	<p>Agregue parámetros de consulta a la URL de VMAP.</p>

	<pre class="line-numbers">
<code class="language-swift" translate="No">// For each source, update each VMAP URL stored in the jsonResponse NSDictionary object and assemble the NSURLQueryItem. Store it in the mutable version of the jsonResponse NSDictionary object.
for (NSDictionary *source in videoPropertiesDictionary[@"sources"])
{
    NSMutableDictionary *mutableSource = [[NSMutableDictionary alloc] init];
    [mutableSource addEntriesFromDictionary:source];

    NSString *vmapURL = mutableSource[@"vmap"];
    components = [NSURLComponents componentsWithString:vmapURL];

    NSArray *queryItemsArray = components.queryItems;
    NSURLQueryItem *bctoken = [queryItemsArray firstObject];
    components.queryItems = @[bctoken, queryItemEntrypointUrlParameter, queryItemVideoId ];
    mutableSource[@"vmap"] = components.URL.absoluteString;

    [updatedSources addObject:mutableSource];
}</code></pre>
	</li>
	<li>
	<p>Procese la URL modificada con el complemento SSAI de la siguiente manera:</p>

	<pre class="line-numbers">
<code class="language-swift" translate="No">videoPropertiesDictionary[@"sources"] = updatedSources;
// Create a new video object with the updated jsonResponse NSDictionary object
BCOVVideo *video = [BCOVPlaybackService videoFromJSONDictionary:videoPropertiesDictionary];
// Setting this video object to the BCOVPlaybackController will call the new vmap URL (with the URL parameters appended) when playback starts.
[self.controller setVideos:@[video]];</code></pre>
	<!-- <p>For a complete code example, expand the <strong>iOS ViewController using Objective-C</strong> section below.</p> --></li>
</ol>
<!-- <details>
    <summary><h2 id="iOS_ViewController_using_Objective-C">iOS ViewController using Objective-C</h2></summary>
<p>Your <strong>ViewController.m</strong> file should look similar to this:</p>

<pre class="line-numbers">
<code class="language-objectivec" translate="No">//
//  ViewController.m
//  SSAI Params
//
//  Copyright © 2018 Brightcove. All rights reserved.
//

#import "ViewController.h"

@import BrightcovePlayerSDK;
@import BrightcoveOUX;

// ** Customize these values with your own account information **
NSString *accountId = @"<span class="bcls-input">your account Id</span>";
NSString *policyKey = @"<span class="bcls-input">your policy key</span>";
NSString *videoId = @"<span class="bcls-input">your video Id</span>";
NSString *adConfigId = @"<span class="bcls-input">your ad configuration Id</span>";

@interface ViewController () &lt;BCOVPlaybackControllerDelegate&gt;

@property (nonatomic, strong) id&lt;BCOVPlaybackController&gt; playbackController;
@property (nonatomic, strong) BCOVPlaybackService *playbackService;
@property (nonatomic) BCOVPUIPlayerView *playerView;
@property (weak, nonatomic) IBOutlet UIView *videoContainerView;
@property (weak, nonatomic) IBOutlet UIView *companionSlotContainerView;
@property(copy) NSArray&lt;NSURLQueryItem *&gt; *queryItems;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    BCOVPlayerSDKManager *manager = [BCOVPlayerSDKManager sharedManager];

    // Create a companion slot.
    BCOVOUXCompanionSlot *companionSlot = [[BCOVOUXCompanionSlot alloc] initWithView:self.companionSlotContainerView width:500 height:61];

    // In order to display an ad progress banner on the top of the view, we create this display container.  This object is also responsible for populating the companion slots.
    BCOVOUXAdComponentDisplayContainer *adComponentDisplayContainer = [[BCOVOUXAdComponentDisplayContainer alloc] initWithCompanionSlots:@[companionSlot]];

    self.controller = [manager createOUXPlaybackControllerWithViewStrategy:nil];

    // In order for the ad display container to receive ad information, we add it as a session consumer.
    [self.controller addSessionConsumer:adComponentDisplayContainer];

    self.controller.delegate = self;
    self.controller.autoPlay = YES;
    self.controller.autoAdvance = YES;

    BCOVPUIBasicControlView *controlView = [BCOVPUIBasicControlView basicControlViewWithVODLayout];
    // Set playback controller later.
    self.playerView = [[BCOVPUIPlayerView alloc] initWithPlaybackController:nil options:nil controlsView:controlView];

    [self.videoContainerView addSubview:self.playerView];
    self.playerView.translatesAutoresizingMaskIntoConstraints = NO;
    [NSLayoutConstraint activateConstraints:@[
        [self.playerView.topAnchor constraintEqualToAnchor:self.videoContainerView.topAnchor],
        [self.playerView.rightAnchor constraintEqualToAnchor:self.videoContainerView.rightAnchor],
        [self.playerView.leftAnchor constraintEqualToAnchor:self.videoContainerView.leftAnchor],
        [self.playerView.bottomAnchor constraintEqualToAnchor:self.videoContainerView.bottomAnchor],
    ]];

    self.playerView.playbackController = self.controller;

    _playbackService = [[BCOVPlaybackService alloc]
                        initWithAccountId:accountId
                        policyKey:policyKey];

    [self requestContentFromPlaybackService];
}

- (void)requestContentFromPlaybackService
{
	// Set your SSAI ad configuration id as a query parameter
  NSDictionary *queryParameters = @{
                                    @"ad_config_id" : kViewControllerAdConfigID
                                    };
  // Retrieve a video from the Playback API using a video Id and your ad config Id
  [self.playbackService findVideoWithVideoID:videoId parameters:queryParameters completion:^(BCOVVideo *video, NSDictionary *jsonResponse, NSError *error) {

    if (video)
    {
      // Create a mutable version of the jsonResponse NSDictionary object
      NSURLComponents *components = [[NSURLComponents alloc] init];
      NSMutableDictionary *videoPropertiesDictionary = [[NSMutableDictionary alloc] init];
      NSMutableArray *updatedSources = [[NSMutableArray alloc] init];

			// Define the URL parameters that will be added to the VMAP URL
      NSURLQueryItem *queryItemEntrypointUrlParameter = [NSURLQueryItem queryItemWithName:@"rule" value:@"discos-enabled"];
      NSURLQueryItem *queryItemVideoId = [NSURLQueryItem queryItemWithName:@"video_id" value:jsonResponse[@"id"]];

      //deserialize the video and store in dictionary
      [videoPropertiesDictionary addEntriesFromDictionary:jsonResponse];

      // For each source, update each VMAP URL stored in the jsonResponse NSDictionary object
      // and assemble the NSURLQueryItem. Store it in the mutable version of the jsonResponse NSDictionary object.
      for (NSDictionary *source in videoPropertiesDictionary[@"sources"])
      {
        NSMutableDictionary *mutableSource = [[NSMutableDictionary alloc] init];
        [mutableSource addEntriesFromDictionary:source];

        NSString *vmapURL = mutableSource[@"vmap"];
        components = [NSURLComponents componentsWithString:vmapURL];

        NSArray *queryItemsArray = components.queryItems;
        NSURLQueryItem *bctoken = [queryItemsArray firstObject];
        components.queryItems = @[bctoken, queryItemEntrypointUrlParameter, queryItemVideoId ];
        mutableSource[@"vmap"] = components.URL.absoluteString;

        [updatedSources addObject:mutableSource];
      }
      videoPropertiesDictionary[@"sources"] = updatedSources;
      // Create a new video object with the updated jsonResponse NSDictionary object
      BCOVVideo *video = [BCOVPlaybackService videoFromJSONDictionary:videoPropertiesDictionary];
      // Setting this video object to the BCOVPlaybackController will call the new vmap URL
      // (with the URL parameters appended) when playback starts.
      [self.controller setVideos:@[video]];
    }
    else
    {
      NSLog(@"ViewController Debug - Error retrieving video playlist: `%@`", error);
    }

  }];
}

@end</code></pre>
</details> -->
</section>
</article>